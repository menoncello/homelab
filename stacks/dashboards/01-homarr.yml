# Homarr Stack
# Dashboard for homelab services
# Deploy with: docker stack deploy -c stacks/homarr-stack/media.docker-compose.yml homarr

version: '3.8'

services:
  homarr:
    image: ghcr.io/homarr-labs/homarr:latest
    hostname: homarr
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.arr == true
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M
      restart_policy:
        condition: on-failure
        max_attempts: 3
    environment:
      - TZ=America/Sao_Paulo
      - TIMEOUT=10000
      - SECRET_ENCRYPTION_KEY=bd01d3b99d7c28f55759aeaaedbe20293dddf52ec6e8b4c59b6885a94465cb19
      - BASE_URL=home.homelab
    volumes:
      - homarr-config:/app/data/configs
      - homarr-data:/app/data
    networks:
      - homelab-net
    ports:
      - target: 7575
        published: 7575
        protocol: tcp
        mode: host

networks:
  homelab-net:
    external: true
    name: homelab-net

volumes:
  homarr-config:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /data/docker/homarr

  homarr-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /data/docker/homarr/data
