# Lidarr Stack
# Music collection manager for Usenet and BitTorrent users
# Deploy with: docker stack deploy -c stacks/lidarr-stack/docker-compose.yml lidarr

version: '3.8'

services:
  lidarr:
    image: ghcr.io/linuxserver/lidarr:latest
    hostname: lidarr
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.arr == true
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 1G
      restart_policy:
        condition: on-failure
        max_attempts: 3
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Sao_Paulo
      - UMASK=022
    volumes:
      - lidarr-config:/config
      - lidarr-downloads:/downloads
      - lidarr-music:/music
    networks:
      - homelab-net
    ports:
      - target: 8686
        published: 8686
        protocol: tcp
        mode: host
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8686/api/v1/system/status?apikey=your_key"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  homelab-net:
    external: true
    name: homelab-net

volumes:
  lidarr-config:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /data/docker/lidarr

  lidarr-downloads:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /media/downloads

  lidarr-music:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /home/docker-data/music
