version: "3.8"

services:
  samba:
    image: dperson/samba:latest
    hostname: helios
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.gpu == true
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    environment:
      # Share configuration: -s share_name;path;[browse;readonly;guest;users;admins;writelist;comment]
      - SHARE=media;/media;yes;no;no;eduardo;;;Media Library
      # User configuration: -u user;password
      - USER=eduardo;${SAMBA_PASSWORD}
      # Global options for macOS compatibility
      - WORKGROUP=WORKGROUP
      - SERVER_MIN_PROTOCOL=SMB2
      - SERVER_MAX_PROTOCOL=SMB3
      - SERVER_SIGNING=auto
      - NTLM_SUPPORT=yes
      - APPLE_SMBX=yes
      - VFS_OBJECTS=catia fruit streams_xattr
      - FRUIT:aapl=yes
      - FRUIT:metadata=stream
      - FRUIT:encoding=UTF8-MAC
      - FRUIT:time_machine=max
    volumes:
      - /media:/media
    ports:
      - "139:139"
      - "445:445"
      - "137:137/udp"
      - "138:138/udp"
